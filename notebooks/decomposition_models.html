
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Solar Decomposition Models &#8212; Solar Resource Assessment in Python</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe,.cell"
        const thebe_selector_input = "pre,.cell_input div.highlight"
        const thebe_selector_output = ".output,.cell_output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="canonical" href="https://assessingsolar.org/notebooks/decomposition_models.html" />
    <link rel="shortcut icon" href="../_static/assessing_solar_favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Overview" href="solar_resource_data_overview.html" />
    <link rel="prev" title="Manipulating Time-series" href="manipulating_time_series.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/assessing_solar_logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Solar Resource Assessment in Python</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   Introduction
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Solar fundamentals
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="solar_position.html">
   Solar Position
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="solar_components.html">
   Solar Components
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="manipulating_time_series.html">
   Manipulating Time-Series
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Solar radiation modeling
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Solar Decomposition Models
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Solar resource data
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="solar_resource_data_overview.html">
   Overview
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="ground_measurements.html">
   Ground Measurements
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="bsrn.html">
     BSRN
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="srml.html">
     SRML
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="satellite_data.html">
   Satellite Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="reanalysis_data.html">
   Reanalysis Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="quality_asessment.html">
   Quality Assessment
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="benchmarking.html">
   Benchmarking
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Applications
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="solar_power_modeling.html">
   Solar Power Modeling
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="site_adaptation.html">
   Site Adaptation
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Appendix
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="glossary.html">
   Glossary
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://iea-pvps.org/research-tasks/solar-resource-for-high-penetration-and-large-scale-applications/">
   IEA PVPS Task 16
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/notebooks/decomposition_models.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        
        <a class="issues-button"
            href="https://github.com/AssessingSolar/AssessingSolar/issues/new?title=Issue%20on%20page%20%2Fnotebooks/decomposition_models.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/AssessingSolar/AssessingSolar/main?urlpath=tree/AssessingSolar/notebooks/decomposition_models.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <button type="button" class="btn btn-secondary topbarbtn"
            onclick="initThebeSBT()" title="Launch Thebe" data-toggle="tooltip" data-placement="left"><i
                class="fas fa-play"></i><span style="margin-left: .4em;">Live Code</span></button>
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-role-of-solar-decomposition-models">
   The role of solar decomposition models
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-preparation">
   Data preparation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#disc-model">
   DISC model
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dirint-model">
   DIRINT model
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#erbs-model">
   Erbs model
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#comparison-and-evaluation-of-decomposition-models">
   Comparison and evaluation of decomposition models
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#section-summary">
   Section summary
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#references">
   References
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="solar-decomposition-models">
<h1>Solar Decomposition Models<a class="headerlink" href="#solar-decomposition-models" title="Permalink to this headline">¶</a></h1>
<p>Direct or beam normal irradiance is often an useful variable in solar and energy applications, for example, in solar concetrating power projects. When the direct normal irradiance (DNI) is not directly measured by pyranometers on site, <strong>solar radiation decomposition models</strong> can assist us in estimating the direct beam radiation by applying an empirical correlations between global horizontal irradiance (GHI), diffuse horizontal irradiance (DHI) and DNI. In this section, we present the implementation in Python of several solar decomposition models.</p>
<hr class="docutils" />
<div style="text-align: right"> <i>Content by Javier Lopez Lorente</i> </div>
<div class="section" id="the-role-of-solar-decomposition-models">
<h2>The role of solar decomposition models<a class="headerlink" href="#the-role-of-solar-decomposition-models" title="Permalink to this headline">¶</a></h2>
<p>Solar decomposition models are one of the most recurrent types of algorithms within solar radiation modelling and are sometimes used as part of a larger analysis. As described earlier, decomposition models permit estimating the beam or direct normal irradiance (DNI) from GHI measurements, through relationships of the clearness index (<span class="math notranslate nohighlight">\(k_t\)</span>) and the diffuse fraction of solar irradiance (<span class="math notranslate nohighlight">\(k_d\)</span>). The clearness index is defined as:</p>
<div class="math notranslate nohighlight">
\[ k_t = \frac{GHI}{E_a \cdot cos(\theta_Z)}\]</div>
<p>where <span class="math notranslate nohighlight">\(E_a\)</span> is the extraterrestrial irradiance, and <span class="math notranslate nohighlight">\(\theta_Z\)</span> is the solar zenith angle.</p>
<p>The diffuse fraction is defined as:</p>
<div class="math notranslate nohighlight">
\[ k_d = \frac{DHI}{GHI} \]</div>
<p>The role of solar decomposition models is illustrated in the diagram below:</p>
<a class="bg-primary mb-1 reference internal image-reference" href="https://assessingsolar.org/notebooks/notebook/graphics/decomposition_models.png"><img alt="https://assessingsolar.org/notebooks/notebook/graphics/decomposition_models.png" class="bg-primary mb-1 align-center" src="https://assessingsolar.org/notebooks/notebook/graphics/decomposition_models.png" style="width: 600px;" /></a>
<p>Multiple models have been proposed for the decomposition of global horizontal radiation/irradiance into its direct normal and diffuse horizontal components in the academic literature. Below, the implementation in Python of some of these methods will be shown. The following methods will be modelled and compared:</p>
<ul class="simple">
<li><p>DISC model (Maxwell, 1987)</p></li>
<li><p>DIRINT model (Pérez et al., 1992)</p></li>
<li><p>Erbs model (Erbs et al., 1982)</p></li>
</ul>
<p>These 3 methods, and some others, are available in the Python library <a class="reference external" href="https://pvlib-python.readthedocs.io/en/stable/api.html#dni-estimation-models">pvlib</a>.</p>
<p>Before starting the modelling of these methods, the data that we will use will be queried and prepared.</p>
</div>
<div class="section" id="data-preparation">
<h2>Data preparation<a class="headerlink" href="#data-preparation" title="Permalink to this headline">¶</a></h2>
<p>To illustrate the implementation of each of these models, we will use real irradiance observations. GHI measurements will be decomponsed into DNI and DHI, and the results will be then compared to actual measurements from DNI and DHI.</p>
<p>Yet, the first step is getting and preparing the real weather data to be used:</p>
<p><strong>Retrieving weather data:</strong></p>
<p>The weather data used is from a meteorological <a class="reference external" href="https://midcdmz.nrel.gov/apps/sitehome.pl?site=UAT">station</a> located at the SOLRMAP University of Arizona (OASIS), which is part of the Measurement and Instrumentation Data Center (MIDC) of the U.S. National Renewable Energy Laboratory (NREL). The coordinates of the station are latitude 32.22969<span class="math notranslate nohighlight">\(^\circ\)</span> and longitude -110.95534<span class="math notranslate nohighlight">\(^\circ\)</span>, and an elevation of 786 AMSL. The data used are 1-minute global, direct and diffuse irradiance measurements for July 2021 (Andreas and Wilcox, 2010).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import all the necessary libraries</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">pvlib</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Variables map to edit the names of certain variables</span>
<span class="n">var_map</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Global Horiz (platform) [W/m^2]&#39;</span><span class="p">:</span> <span class="s1">&#39;ghi&#39;</span><span class="p">,</span>
           <span class="s1">&#39;Direct Normal [W/m^2]&#39;</span><span class="p">:</span><span class="s1">&#39;dni&#39;</span><span class="p">,</span>
           <span class="s1">&#39;Diffuse Horiz [W/m^2]&#39;</span><span class="p">:</span><span class="s1">&#39;dhi&#39;</span><span class="p">,</span>
           <span class="s1">&#39;Air Temperature [deg C]&#39;</span><span class="p">:</span> <span class="s1">&#39;tamb_degC&#39;</span><span class="p">,</span> 
           <span class="s1">&#39;Rel Humidity [%]&#39;</span><span class="p">:</span> <span class="s1">&#39;RH&#39;</span><span class="p">,</span>
           <span class="s1">&#39;Station Pressure [mBar]&#39;</span><span class="p">:</span><span class="s1">&#39;P_mbar&#39;</span><span class="p">}</span>

<span class="c1"># Retrieving the raw data from the station </span>
<span class="n">df_ref</span> <span class="o">=</span> <span class="n">pvlib</span><span class="o">.</span><span class="n">iotools</span><span class="o">.</span><span class="n">read_midc_raw_data_from_nrel</span><span class="p">(</span><span class="s1">&#39;UAT&#39;</span><span class="p">,</span>                     <span class="c1"># Station id</span>
                                                    <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;20210701&#39;</span><span class="p">),</span>   <span class="c1"># Start date YYYYMMDD</span>
                                                    <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;20210731&#39;</span><span class="p">),</span>   <span class="c1"># End date  YYYYMMDD</span>
                                                    <span class="n">variable_map</span><span class="o">=</span><span class="n">var_map</span><span class="p">)</span>       <span class="c1"># Variable Map</span>

<span class="c1"># Let&#39;s have a look to the first 2 rows of the dataset</span>
<span class="n">df_ref</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Unnamed: 0</th>
      <th>Year</th>
      <th>DOY</th>
      <th>MST</th>
      <th>dni</th>
      <th>dhi</th>
      <th>Global Horiz (tracker) [W/m^2]</th>
      <th>ghi</th>
      <th>Temp CHP1 [deg C]</th>
      <th>Temp CM22 (tracker) [deg C]</th>
      <th>Temp CM22 (platform) [deg C]</th>
      <th>CR1000 Temp [deg C]</th>
      <th>CR1000 Battery [VDC]</th>
      <th>tamb_degC</th>
      <th>RH</th>
      <th>P_mbar</th>
      <th>Avg Wind Speed @ 3m [m/s]</th>
      <th>Avg Wind Direction @ 3m [deg from N]</th>
      <th>Peak Wind Speed @ 3m [m/s]</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2021-07-01 00:00:00-07:00</th>
      <td>0</td>
      <td>2021</td>
      <td>182</td>
      <td>0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>-1.85080</td>
      <td>-2.05728</td>
      <td>-246.8</td>
      <td>-246.8</td>
      <td>-246.8</td>
      <td>28.27</td>
      <td>13.27</td>
      <td>26.36</td>
      <td>54.01</td>
      <td>925.057</td>
      <td>2.471</td>
      <td>334.4</td>
      <td>5.45</td>
    </tr>
    <tr>
      <th>2021-07-01 00:01:00-07:00</th>
      <td>0</td>
      <td>2021</td>
      <td>182</td>
      <td>1</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>-1.85081</td>
      <td>-2.05729</td>
      <td>-246.8</td>
      <td>-246.8</td>
      <td>-246.8</td>
      <td>28.26</td>
      <td>13.27</td>
      <td>26.35</td>
      <td>53.93</td>
      <td>925.077</td>
      <td>3.172</td>
      <td>335.3</td>
      <td>5.45</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Besides GHI, DNI and DHI, this station has additional weather-related variables available (e.g., air temperature, humidity, and wind speed), as well as sensor-specific data. The details of the sensors and measurements available in each station can be found under the section “Instrument history and meta data” of each MIDC’s station webpage.</p>
<p>Let’s list the variables available and then subset those that we will use in this example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Visualize variables avilable</span>
<span class="n">df_ref</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;Unnamed: 0&#39;, &#39;Year&#39;, &#39;DOY&#39;, &#39;MST&#39;, &#39;dni&#39;, &#39;dhi&#39;,
       &#39;Global Horiz (tracker) [W/m^2]&#39;, &#39;ghi&#39;, &#39;Temp CHP1 [deg C]&#39;,
       &#39;Temp CM22 (tracker) [deg C]&#39;, &#39;Temp CM22 (platform) [deg C]&#39;,
       &#39;CR1000 Temp [deg C]&#39;, &#39;CR1000 Battery [VDC]&#39;, &#39;tamb_degC&#39;, &#39;RH&#39;,
       &#39;P_mbar&#39;, &#39;Avg Wind Speed @ 3m [m/s]&#39;,
       &#39;Avg Wind Direction @ 3m [deg from N]&#39;, &#39;Peak Wind Speed @ 3m [m/s]&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Dataframe with the variables used in the example</span>
<span class="n">decomp</span> <span class="o">=</span> <span class="n">df_ref</span><span class="p">[[</span><span class="s1">&#39;ghi&#39;</span><span class="p">,</span><span class="s1">&#39;dni&#39;</span><span class="p">,</span><span class="s1">&#39;dhi&#39;</span><span class="p">,</span> <span class="s1">&#39;tamb_degC&#39;</span><span class="p">,</span> <span class="s1">&#39;RH&#39;</span><span class="p">,</span> <span class="s1">&#39;P_mbar&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s have a look to the statistical description of the data:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">decomp</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ghi</th>
      <th>dni</th>
      <th>dhi</th>
      <th>tamb_degC</th>
      <th>RH</th>
      <th>P_mbar</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>44640.000000</td>
      <td>44640.000000</td>
      <td>44640.000000</td>
      <td>44640.000000</td>
      <td>44640.000000</td>
      <td>44640.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>270.016692</td>
      <td>244.196683</td>
      <td>93.612505</td>
      <td>29.588765</td>
      <td>49.146020</td>
      <td>925.919327</td>
    </tr>
    <tr>
      <th>std</th>
      <td>352.199196</td>
      <td>344.676616</td>
      <td>123.876749</td>
      <td>5.181255</td>
      <td>20.025314</td>
      <td>1.793095</td>
    </tr>
    <tr>
      <th>min</th>
      <td>-7.540170</td>
      <td>-5.782160</td>
      <td>-0.721871</td>
      <td>19.670000</td>
      <td>10.780000</td>
      <td>920.315000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>-2.057020</td>
      <td>-0.130126</td>
      <td>0.000000</td>
      <td>25.630000</td>
      <td>31.720000</td>
      <td>924.885000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>45.498000</td>
      <td>0.238494</td>
      <td>41.863400</td>
      <td>28.640000</td>
      <td>49.640000</td>
      <td>925.900000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>536.188000</td>
      <td>588.421000</td>
      <td>139.650000</td>
      <td>33.600000</td>
      <td>64.250000</td>
      <td>927.132000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>1502.680000</td>
      <td>927.270000</td>
      <td>711.501000</td>
      <td>42.650000</td>
      <td>100.000000</td>
      <td>931.300000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>The statistical description of the data gives us an idea of the range of the data. We can also visualize one or several days to see the measurements of GHI, DHI and DNI. For example, a plot for a single day (8th July 2021):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># list variables to plot</span>
<span class="n">all_series</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ghi&#39;</span><span class="p">,</span> <span class="s1">&#39;dhi&#39;</span><span class="p">,</span> <span class="s1">&#39;dni&#39;</span><span class="p">]</span>

<span class="c1"># Plot by iterating a the loop using the &#39;pandas.DataFrame.plot()&#39; method. </span>
<span class="k">for</span> <span class="n">series</span> <span class="ow">in</span> <span class="n">all_series</span><span class="p">:</span>
    <span class="n">decomp</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;20210708&#39;</span><span class="p">][</span><span class="n">series</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">series</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span> <span class="c1"># Date format YYYYMMDD</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Solar irradiance components, 8th July 2021&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Irradiance [W/m$^2$]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7fd7beacda50&gt;
</pre></div>
</div>
<img alt="../_images/decomposition_models_13_1.png" src="../_images/decomposition_models_13_1.png" />
</div>
</div>
<p><strong>Estimating other input variables:</strong></p>
<p>The 3 solar decomposition models that we will implement in this section (i.e., DISC, DIRINT and Erbs models) have different inputs to be implemented. <strong>Solar position data</strong> is a common input for the 3 models. The DISC and DIRINT models accept as a possible input the <strong>dew (wet-bulb) temperature</strong> (<span class="math notranslate nohighlight">\(T_d\)</span>). This variable is not directly available from our weather observations; however, it can be easily estimated using a simple conversion that has relative humidity (<span class="math notranslate nohighlight">\(RH\)</span>) and the ambient temperature (<span class="math notranslate nohighlight">\(T_a\)</span>) as input. This simple approximation is given by the equation below (Lawrence, 2005):</p>
<div class="math notranslate nohighlight">
\[ T_{d} = T_a (^{\circ} C) - \frac{100-RH (\%)}{5} \]</div>
<p>In Python, this equation could be implemented as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tdew</span> <span class="o">=</span> <span class="n">decomp</span><span class="p">[</span><span class="s1">&#39;tamb_degC&#39;</span><span class="p">]</span><span class="o">-</span><span class="p">((</span><span class="mi">100</span><span class="o">-</span><span class="n">decomp</span><span class="p">[</span><span class="s1">&#39;RH&#39;</span><span class="p">])</span><span class="o">/</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Variables related to solar position can be estimated in straight-forward manner with the method ‘pvlib.solarposition.get_solarposition’ of pvlib.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Coordinates and elevation of the weather station SOLRMAP University of Arizona (OASIS)</span>
<span class="n">lat</span> <span class="o">=</span> <span class="mf">32.22969</span>
<span class="n">lon</span> <span class="o">=</span> <span class="o">-</span><span class="mf">110.95534</span>
<span class="n">alt</span> <span class="o">=</span> <span class="mi">786</span>

<span class="c1"># Estimate Solar Position</span>
<span class="n">solpos</span> <span class="o">=</span> <span class="n">pvlib</span><span class="o">.</span><span class="n">solarposition</span><span class="o">.</span><span class="n">get_solarposition</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">decomp</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                                               <span class="n">latitude</span><span class="o">=</span><span class="n">lat</span><span class="p">,</span>
                                               <span class="n">longitude</span><span class="o">=</span><span class="n">lon</span><span class="p">,</span>
                                               <span class="n">altitude</span><span class="o">=</span><span class="n">alt</span><span class="p">,</span>
                                               <span class="n">temperature</span><span class="o">=</span><span class="n">decomp</span><span class="p">[</span><span class="s1">&#39;tamb_degC&#39;</span><span class="p">],</span>
                                               <span class="n">pressure</span><span class="o">=</span><span class="n">decomp</span><span class="p">[</span><span class="s1">&#39;P_mbar&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">1000</span><span class="p">)</span> <span class="c1"># pressure in Pascal</span>

<span class="c1"># Let&#39;s have a look to the output</span>
<span class="n">solpos</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>apparent_zenith</th>
      <th>zenith</th>
      <th>apparent_elevation</th>
      <th>elevation</th>
      <th>azimuth</th>
      <th>equation_of_time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2021-07-01 00:00:00-07:00</th>
      <td>124.293142</td>
      <td>124.293142</td>
      <td>-34.293142</td>
      <td>-34.293142</td>
      <td>352.285310</td>
      <td>-3.873236</td>
    </tr>
    <tr>
      <th>2021-07-01 00:01:00-07:00</th>
      <td>124.321069</td>
      <td>124.321069</td>
      <td>-34.321069</td>
      <td>-34.321069</td>
      <td>352.561624</td>
      <td>-3.873369</td>
    </tr>
    <tr>
      <th>2021-07-01 00:02:00-07:00</th>
      <td>124.347985</td>
      <td>124.347985</td>
      <td>-34.347985</td>
      <td>-34.347985</td>
      <td>352.838177</td>
      <td>-3.873502</td>
    </tr>
    <tr>
      <th>2021-07-01 00:03:00-07:00</th>
      <td>124.373887</td>
      <td>124.373887</td>
      <td>-34.373887</td>
      <td>-34.373887</td>
      <td>353.114958</td>
      <td>-3.873636</td>
    </tr>
    <tr>
      <th>2021-07-01 00:04:00-07:00</th>
      <td>124.398775</td>
      <td>124.398775</td>
      <td>-34.398775</td>
      <td>-34.398775</td>
      <td>353.391959</td>
      <td>-3.873769</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="disc-model">
<h2>DISC model<a class="headerlink" href="#disc-model" title="Permalink to this headline">¶</a></h2>
<p>The DISC model (Maxwell, 1987) can be implemented in Python by passing as inputs the GHI, solar zenith angle and the atmospheric pressure, which is used to estimate the absolute (pressure-corrected) airmass. The method can be equally applied with the relative airmass by passing <em>‘None’</em> to the pressure.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># DISC method estimated with absolute airmass as input</span>
<span class="n">disc</span> <span class="o">=</span> <span class="n">pvlib</span><span class="o">.</span><span class="n">irradiance</span><span class="o">.</span><span class="n">disc</span><span class="p">(</span><span class="n">decomp</span><span class="p">[</span><span class="s1">&#39;ghi&#39;</span><span class="p">],</span> 
                             <span class="n">solpos</span><span class="p">[</span><span class="s1">&#39;apparent_zenith&#39;</span><span class="p">],</span> 
                             <span class="n">decomp</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                             <span class="n">pressure</span><span class="o">=</span><span class="n">decomp</span><span class="p">[</span><span class="s1">&#39;P_mbar&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span> <span class="c1"># Pressure in Pascal (1 mbar = 100 Pa)</span>
</pre></div>
</div>
</div>
</div>
<p>The method returns the DNI, the clearness index (<span class="math notranslate nohighlight">\(k_t\)</span>) and the airmass estimation:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">disc</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;dni&#39;, &#39;kt&#39;, &#39;airmass&#39;], dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="dirint-model">
<h2>DIRINT model<a class="headerlink" href="#dirint-model" title="Permalink to this headline">¶</a></h2>
<p>The DIRINT model (Pérez et al., 1992) can be implemented in a similar way in Python. The inputs for the built-in pvlib function are GHI, solar zenith angle, atmospheric pressure, and dew (wet-bulb) temperature.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Estimation of the DIRINT model</span>
<span class="n">dirint</span> <span class="o">=</span> <span class="n">pvlib</span><span class="o">.</span><span class="n">irradiance</span><span class="o">.</span><span class="n">dirint</span><span class="p">(</span><span class="n">decomp</span><span class="p">[</span><span class="s1">&#39;ghi&#39;</span><span class="p">],</span> <span class="c1"># GHI</span>
                                 <span class="n">solpos</span><span class="p">[</span><span class="s1">&#39;apparent_zenith&#39;</span><span class="p">],</span> <span class="c1"># Solar zenith angle </span>
                                 <span class="n">decomp</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>  <span class="c1"># timestamps</span>
                                 <span class="n">pressure</span><span class="o">=</span><span class="n">decomp</span><span class="p">[</span><span class="s1">&#39;P_mbar&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="c1"># atmospheric pressure in Pascal </span>
                                 <span class="n">temp_dew</span><span class="o">=</span><span class="n">tdew</span><span class="p">)</span> <span class="c1"># Dew temperature in Degree Celsius</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="erbs-model">
<h2>Erbs model<a class="headerlink" href="#erbs-model" title="Permalink to this headline">¶</a></h2>
<p>The Erbs model (Erbs et al., 1982) is a simple model that only requires GHI and the solar position through the solar zenith angle. This model is also available in pvlib and the implementation is equally straight-forward:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">erbs</span> <span class="o">=</span> <span class="n">pvlib</span><span class="o">.</span><span class="n">irradiance</span><span class="o">.</span><span class="n">erbs</span><span class="p">(</span><span class="n">decomp</span><span class="p">[</span><span class="s1">&#39;ghi&#39;</span><span class="p">],</span> <span class="c1"># GHI</span>
                             <span class="n">solpos</span><span class="p">[</span><span class="s1">&#39;apparent_zenith&#39;</span><span class="p">],</span> <span class="c1"># Solar zenith angle </span>
                             <span class="n">decomp</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>  <span class="c1"># timestamps</span>

<span class="n">erbs</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;dni&#39;, &#39;dhi&#39;, &#39;kt&#39;], dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="comparison-and-evaluation-of-decomposition-models">
<h2>Comparison and evaluation of decomposition models<a class="headerlink" href="#comparison-and-evaluation-of-decomposition-models" title="Permalink to this headline">¶</a></h2>
<p>Once the 3 models are estimated, we can evaluate the results of the models against the actual DNI measurements available. For example, below we visualize the results of the models a single day and 1 week in July:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot of models for a single day</span>
<span class="n">disc</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;20210707&#39;</span><span class="p">][</span><span class="s1">&#39;dni&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;DISC&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span> <span class="c1"># format of date YYYYMMDD</span>
<span class="n">dirint</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;20210707&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;DIRINT&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">erbs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;20210707&#39;</span><span class="p">][</span><span class="s1">&#39;dni&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Erbs&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">decomp</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;20210707&#39;</span><span class="p">][</span><span class="s1">&#39;dni&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Reference&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1200</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Direct Normal Irradiance [W/m$^2$]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time [HH:MM]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Decomposition Models in Sample Day</span><span class="se">\n</span><span class="s1"> (7th July 2021)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7fd7bea078d0&gt;
</pre></div>
</div>
<img alt="../_images/decomposition_models_27_1.png" src="../_images/decomposition_models_27_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot of models for several days</span>
<span class="n">disc</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;20210705&#39;</span><span class="p">:</span><span class="s1">&#39;20210712&#39;</span><span class="p">][</span><span class="s1">&#39;dni&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;DISC&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span> <span class="c1"># format of date YYYYMMDD</span>
<span class="n">dirint</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;20210705&#39;</span><span class="p">:</span><span class="s1">&#39;20210712&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;DIRINT&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">erbs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;20210705&#39;</span><span class="p">:</span><span class="s1">&#39;20210712&#39;</span><span class="p">][</span><span class="s1">&#39;dni&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Erbs&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">decomp</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;20210705&#39;</span><span class="p">:</span><span class="s1">&#39;20210712&#39;</span><span class="p">][</span><span class="s1">&#39;dni&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Reference&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1200</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Direct Normal Irradiance [W/m$^2$]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Decomposition Models in Sample Days</span><span class="se">\n</span><span class="s1"> (5th-12th July 2021)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">ncol</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7fd7be74df90&gt;
</pre></div>
</div>
<img alt="../_images/decomposition_models_28_1.png" src="../_images/decomposition_models_28_1.png" />
</div>
</div>
<p>The correlation between the obtained models and the measured observations can be also presented in <strong>scatter plots</strong>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create multiple plots</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span> <span class="o">=</span> <span class="mf">.5</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">.001</span><span class="p">)</span>

<span class="c1"># Wrap the axes</span>
<span class="n">axs</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

<span class="c1"># Plot</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">decomp</span><span class="p">[</span><span class="s1">&#39;dni&#39;</span><span class="p">],</span> <span class="n">dirint</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">decomp</span><span class="p">[</span><span class="s1">&#39;dni&#39;</span><span class="p">],</span> <span class="n">disc</span><span class="p">[</span><span class="s1">&#39;dni&#39;</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span> 
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">decomp</span><span class="p">[</span><span class="s1">&#39;dni&#39;</span><span class="p">],</span> <span class="n">erbs</span><span class="p">[</span><span class="s1">&#39;dni&#39;</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

<span class="c1"># Add characteristics to each subplot in a loop</span>
<span class="n">plots</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;DIRINT&#39;</span><span class="p">,</span> <span class="s1">&#39;DISC&#39;</span><span class="p">,</span> <span class="s1">&#39;ERBS&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Observed DNI [W/m$^2$]&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Modelled DNI [W/m$^2$]&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1100</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1100</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">plots</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/decomposition_models_30_0.png" src="../_images/decomposition_models_30_0.png" />
</div>
</div>
<p>The evaluation cannot be only based on a visual inspection. For solar resource assessment, there are a number of common metrics to evaluate the error and performance, which we will use below. These metrics are the mean bias error (MBE) and the root mean square error (RMSE). The MBE is the average error representing a systematic error to under- or overestimate and the RMSE is a measure of the dispersion of the deviations.</p>
<div class="math notranslate nohighlight">
\[ MBE = \frac{1}{n} \sum_{i=1}^{n} M_i - O_i \]</div>
<div class="math notranslate nohighlight">
\[ RMSE = \sqrt{\frac{1}{n}\sum_{i=1}^{n}{(M_i - O_i)^2}}\]</div>
<p>where <span class="math notranslate nohighlight">\(n\)</span> is the size of the sample or dataset, <span class="math notranslate nohighlight">\(M_i\)</span> is each of the predicted values and <span class="math notranslate nohighlight">\(O_i\)</span> are the observed or true values. In Python, each of these evaluation metrics can be defined as function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Mean Bias Error</span>
<span class="k">def</span> <span class="nf">mbe</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">observed</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">predictions</span> <span class="o">-</span> <span class="n">observed</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="c1"># Root Mean Square Error </span>
<span class="k">def</span> <span class="nf">rmse</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">observed</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(((</span><span class="n">predictions</span> <span class="o">-</span> <span class="n">observed</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<p>The performance metrics for DNI estimations can be obtained using these functions.</p>
<p>For the DISC method:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mbe_disc</span> <span class="o">=</span> <span class="n">mbe</span><span class="p">(</span><span class="n">disc</span><span class="p">[</span><span class="s1">&#39;dni&#39;</span><span class="p">],</span> <span class="n">decomp</span><span class="p">[</span><span class="s1">&#39;dni&#39;</span><span class="p">])</span>
<span class="n">rmse_disc</span> <span class="o">=</span> <span class="n">rmse</span><span class="p">(</span><span class="n">disc</span><span class="p">[</span><span class="s1">&#39;dni&#39;</span><span class="p">],</span> <span class="n">decomp</span><span class="p">[</span><span class="s1">&#39;dni&#39;</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DISC Decomposition Method:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MBE &quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">mbe_disc</span> <span class="o">+</span> <span class="s2">&quot; W/m</span><span class="se">\u00b2</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;RMSE &quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">rmse_disc</span> <span class="o">+</span> <span class="s2">&quot; W/m</span><span class="se">\u00b2</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DISC Decomposition Method:
MBE -8.70 W/m²
RMSE 87.27 W/m²
</pre></div>
</div>
</div>
</div>
<p>For the DIRINT method:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mbe_dirint</span> <span class="o">=</span> <span class="n">mbe</span><span class="p">(</span><span class="n">dirint</span><span class="p">,</span> <span class="n">decomp</span><span class="p">[</span><span class="s1">&#39;dni&#39;</span><span class="p">])</span>
<span class="n">rmse_dirint</span> <span class="o">=</span> <span class="n">rmse</span><span class="p">(</span><span class="n">dirint</span><span class="p">,</span> <span class="n">decomp</span><span class="p">[</span><span class="s1">&#39;dni&#39;</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DIRINT Decomposition Method:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MBE &quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">mbe_dirint</span> <span class="o">+</span> <span class="s2">&quot; W/m</span><span class="se">\u00b2</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;RMSE &quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">rmse_dirint</span> <span class="o">+</span> <span class="s2">&quot; W/m</span><span class="se">\u00b2</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DIRINT Decomposition Method:
MBE 11.08 W/m²
RMSE 90.95 W/m²
</pre></div>
</div>
</div>
</div>
<p>For the Erbs method:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mbe_erbs</span> <span class="o">=</span> <span class="n">mbe</span><span class="p">(</span><span class="n">erbs</span><span class="p">[</span><span class="s1">&#39;dni&#39;</span><span class="p">],</span> <span class="n">decomp</span><span class="p">[</span><span class="s1">&#39;dni&#39;</span><span class="p">])</span>
<span class="n">rmse_erbs</span> <span class="o">=</span> <span class="n">rmse</span><span class="p">(</span><span class="n">erbs</span><span class="p">[</span><span class="s1">&#39;dni&#39;</span><span class="p">],</span> <span class="n">decomp</span><span class="p">[</span><span class="s1">&#39;dni&#39;</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Erbs Decomposition Method:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MBE &quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">mbe_erbs</span> <span class="o">+</span> <span class="s2">&quot; W/m</span><span class="se">\u00b2</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;RMSE &quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">rmse_erbs</span> <span class="o">+</span> <span class="s2">&quot; W/m</span><span class="se">\u00b2</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Erbs Decomposition Method:
MBE 2.73 W/m²
RMSE 81.29 W/m²
</pre></div>
</div>
</div>
</div>
<p>The performance metrics show that, in this example, the Erbs method reports the lowest error metrics, closely followed by the DISC and the DIRINT methods, respectively.</p>
</div>
<div class="section" id="section-summary">
<h2>Section summary<a class="headerlink" href="#section-summary" title="Permalink to this headline">¶</a></h2>
<p>This section has presented the solar radiation decomposition methods, which are a common type of technique to estimate the direct normal or beam irradiance from global horizontal irradiance observations. Particularly, the following examples have been covered: <br></p>
<ul class="simple">
<li><p>The Python implementation of three solar radiation decomposition methods have been presented using real data, namely the models used are the DISC, DIRINT and Erbs models. <br></p></li>
<li><p>Time-series visualization and scatter plots have been introduced to evaluate differences in the models. <br></p></li>
<li><p>Two common error metrics to evaluate the performance, i.e. MBE and RMSE, have been introduced. <br></p></li>
</ul>
<p>Within solar resource assessment, decomposition methods are used as means to estimate the direct irradiance or irradiation for further analysis in particular applications. For example, in solar concentrating power where direct irradiance is essential for power generation availability. There are multiple decomposition methods available in the literature. However, the Python functions for these 3 methods are available in the Python library <em>pvlib</em>.</p>
</div>
<hr class="docutils" />
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<p>Andreas, A., and Wilcox, S., (2010). ‘Observed atmospheric and solar information system (OASIS)’, Tucson, Arizona (Data), NREL Report No. DA-5500-56494. <a class="reference external" href="http://dx.doi.org/10.5439/1052226">http://dx.doi.org/10.5439/1052226</a></p>
<p>Erbs, D. G., Klein, S. A., and Duffie, J. A., (1982). ‘Estimation of the diffuse radiation fraction for hourly, daily and monthly-average global radiation’, Solar Energy 28(4), pp 293-302.</p>
<p>Lawrence, M. G. (2005). ‘The relationship between relative humidity and the dewpoint temperature in moist air: A simple conversion and applications’, Bulletin of the American Meteorological Society, 86(2), pp. 225-234. <a class="reference external" href="https://doi.org/10.1175/BAMS-86-2-225">https://doi.org/10.1175/BAMS-86-2-225</a></p>
<p>Maxwell, E. L., (1987). ‘A quasi-physical model for converting hourly global horizontal to direct normal insolation’, Technical Report No. SERI/TR-215-3087, Golden, CO: Solar Energy Research Institute.</p>
<p>Perez, R., Ineichen, P., Maxwell, E.,  Seals, R., and Zelenka, A., (1992). ‘Dynamic global-to-direct irradiance conversion models’. ASHRAE Transactions-Research Series, pp. 354-369</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "AssessingSolar/AssessingSolar",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="manipulating_time_series.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title">Manipulating Time-series</p>
            </div>
        </a>
    </div>
     <div id="next">
        <a class="right-next" href="solar_resource_data_overview.html" title="next page">
            <div class="prevnext-info">
                <p class="prevnext-label">next</p>
                <p class="prevnext-title">Overview</p>
            </div>
            <i class="prevnext-label fas fa-angle-right"></i>
        </a>
     </div>

</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By The Assessing Solar Community<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
<script async="" src="https://www.google-analytics.com/analytics.js"></script>
<script>
                        window.ga = window.ga || function () {
                            (ga.q = ga.q || []).push(arguments) };
                        ga.l = +new Date;
                        ga('create', 'UA-207152593-1', 'auto');
                        ga('set', 'anonymizeIp', true);
                        ga('send', 'pageview');
                    </script>

  </body>
</html>